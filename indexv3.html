<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>L'Univers d'iProMx - Streaming</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;900&family=Lato:wght@300;400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="stylesheet" href="stylesv3.css">
    <link rel="shortcut icon" href="images/logo.webp">
</head>
<body>

    <!-- MODAL ALERTE MODE INVITÉ -->
    <div class="guest-modal" id="guestModal">
        <div class="guest-modal-content">
            <div class="guest-modal-icon">
                <i class="fas fa-exclamation-triangle"></i>
            </div>
            <h2>Mode Invité</h2>
            <p>Vous naviguez en mode invité. Vos données (historique, ma liste) ne seront pas sauvegardées de manière permanente.</p>
            <p class="guest-modal-tip">Pour une expérience optimale et sauvegarder vos données, connectez-vous avec Discord.</p>
            <div class="guest-modal-actions">
                <button class="btn-guest-primary" onclick="closeGuestModal()">
                    <i class="fas fa-check"></i> J'ai compris
                </button>
                <button class="btn-guest-secondary" onclick="redirectToConnection()">
                    <i class="fas fa-sign-in-alt"></i> Je me connecte
                </button>
            </div>
        </div>
    </div>

    <!-- MODAL GESTION HISTORIQUE -->
    <div class="manage-modal" id="manageHistoryModal">
        <div class="manage-modal-content">
            <button class="modal-close-btn" onclick="closeManageHistory()">
                <i class="fas fa-times"></i>
            </button>
            <h2><i class="fas fa-history"></i> Gérer l'historique</h2>
            <div class="manage-list" id="manageHistoryList"></div>
            <div class="manage-actions">
                <button class="btn-delete-selected" onclick="deleteSelectedHistory()">
                    <i class="fas fa-trash"></i> Supprimer la sélection
                </button>
                <button class="btn-delete-all" onclick="deleteAllHistory()">
                    <i class="fas fa-trash-alt"></i> Tout supprimer
                </button>
            </div>
        </div>
    </div>

    <!-- MODAL GESTION MA LISTE -->
    <div class="manage-modal" id="manageListModal">
        <div class="manage-modal-content">
            <button class="modal-close-btn" onclick="closeManageList()">
                <i class="fas fa-times"></i>
            </button>
            <h2><i class="fas fa-star"></i> Gérer Ma Liste</h2>
            <div class="manage-list" id="manageListList"></div>
            <div class="manage-actions">
                <button class="btn-delete-selected" onclick="deleteSelectedList()">
                    <i class="fas fa-trash"></i> Supprimer la sélection
                </button>
                <button class="btn-delete-all" onclick="deleteAllList()">
                    <i class="fas fa-trash-alt"></i> Tout supprimer
                </button>
            </div>
        </div>
    </div>

    <!-- NAVBAR -->
    <nav class="navbar" id="navbar">
        <div class="navbar-container">
            <div class="navbar-left">
                <div class="logo" onclick="window.location.reload()">
                    <img src="images/logo.webp" alt="iPROMX" class="logo-image">
                    <span class="logo-text">iPROMX</span>
                </div>
                <div class="nav-links">
                    <a href="#browse" class="nav-link">Parcourir</a>
                    <a href="#historique" class="nav-link">Historique</a>
                    <a href="#maliste" class="nav-link">Ma Liste</a>
                </div>
            </div>
            <div class="navbar-right">
                <button class="search-btn" id="searchTrigger">
                    <i class="fas fa-search"></i>
                </button>
                <a href="https://www.twitch.tv/ipromx" target="_blank" class="live-indicator-nav" id="liveIndicatorNav">
                    <span class="live-dot"></span>
                    <span class="live-text">VÉRIFICATION...</span>
                </a>
                <div id="userInfo" style="display: none; align-items: center; gap: 12px; margin-left: 20px;">
                    <img id="userAvatar" src="" alt="Avatar" class="user-avatar">
                    <span id="userName" class="user-name"></span>
                    <button id="btnLogout" class="btn-logout">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- HERO BANNER -->
    <div class="hero-banner-large" id="heroBanner">
        <div class="hero-background" style="background-image: url('images/ipromxbackground.png');"></div>
        <div class="hero-content-large">
            <h1 class="hero-title-large">L'UNIVERS D'iPROMX</h1>
            <p class="hero-description-large">Découvrez les sagas criminelles, les alliances, les trahisons et les légendes qui traversent les générations. Une expérience immersive unique dans l'univers du RP.</p>
            <div class="hero-buttons-large">
                <button class="btn-hero btn-play" onclick="document.getElementById('univers').scrollIntoView({behavior: 'smooth'})">
                    <i class="fas fa-play"></i>
                    EXPLORER L'UNIVERS
                </button>
            </div>
        </div>
    </div>

    <!-- RECHERCHE OVERLAY -->
    <div class="search-overlay" id="searchOverlay">
        <div class="search-container">
            <div class="search-header">
                <div class="search-eye-large">
                    <div class="eye-outer-large">
                        <div class="eye-inner-large">
                            <div class="pupil-large"></div>
                            <div class="eye-shine"></div>
                        </div>
                    </div>
                </div>
                <h2>L'ŒIL DU FAUCON</h2>
            </div>
            <div class="search-input-wrapper">
                <input type="text" class="search-input-large" id="searchInput" placeholder="Rechercher un personnage, une famille...">
                <button class="search-close" id="searchClose">×</button>
            </div>
            <div class="search-results-grid" id="searchResults"></div>
        </div>
    </div>

    <!-- SECTION LIVE -->
    <div class="section-crunchyroll" id="statut">
        <div class="section-header-cr">
            <h2 class="section-title-cr">
                <i class="fas fa-circle live-icon"></i>
                STATUT TWITCH
            </h2>
        </div>
        <div class="live-card-compact">
            <div class="live-thumbnail-compact" style="background-image: url('images/ipromxgrrrrrr.jpg');">
                <div class="live-badge-overlay" id="liveBadge">
                    <i class="fas fa-circle"></i>
                    <span id="liveStatus">VÉRIFICATION...</span>
                </div>
            </div>
            <div class="live-info-compact">
                <h3 id="liveTitle">iProMx sur Twitch</h3>
                <p id="liveDescription">Vérification du statut...</p>
                <div class="live-stats-compact">
                    <span><i class="fas fa-users"></i> 271K followers</span>
                    <span id="lastLiveDate"><i class="fas fa-calendar"></i> --</span>
                </div>
            </div>
            <button class="btn-watch-live-compact" onclick="window.open('https://www.twitch.tv/ipromx', '_blank')">
                <i class="fab fa-twitch"></i>
                REGARDER
            </button>
        </div>
    </div>

    <!-- HISTORIQUE -->
    <div class="section-crunchyroll" id="historique" style="display: none;">
        <div class="section-header-cr">
            <h2 class="section-title-cr">
                <i class="fas fa-history"></i>
                Continuer à regarder
            </h2>
            <button class="clear-btn" onclick="openManageHistory()">
                <i class="fas fa-cog"></i> Gérer
            </button>
        </div>
        <div class="history-horizontal-list" id="historyCards"></div>
    </div>

    <!-- MA LISTE -->
    <div class="section-crunchyroll" id="maliste" style="display: none;">
        <div class="section-header-cr">
            <h2 class="section-title-cr">
                <i class="fas fa-star"></i>
                Ma Liste
            </h2>
            <button class="clear-btn" onclick="openManageList()">
                <i class="fas fa-cog"></i> Gérer
            </button>
        </div>
        <div class="carousel-container">
            <button class="carousel-btn carousel-prev" onclick="scrollCarousel('mylist', -1)">
                <i class="fas fa-chevron-left"></i>
            </button>
            <div class="carousel-track" id="mylistCards"></div>
            <button class="carousel-btn carousel-next" onclick="scrollCarousel('mylist', 1)">
                <i class="fas fa-chevron-right"></i>
            </button>
        </div>
    </div>

    <!-- TOUS LES UNIVERS -->
    <div class="section-crunchyroll" id="univers">
        <div class="section-header-cr">
            <h2 class="section-title-cr">
                <i class="fas fa-film"></i>
                Tous les Univers
            </h2>
            <div class="filter-tabs">
                <button class="filter-tab active" onclick="filterFamily('all')">Tous</button>
                <button class="filter-tab" onclick="filterFamily('flash')">Flash</button>
                <button class="filter-tab" onclick="filterFamily('shade')">Shade</button>
                <button class="filter-tab" onclick="filterFamily('winters')">Winters</button>
                <button class="filter-tab" onclick="filterFamily('escobar')">Escobar</button>
                <button class="filter-tab" onclick="filterFamily('kingsley')">Kingsley</button>
            </div>
        </div>
        <div class="carousel-container">
            <button class="carousel-btn carousel-prev" onclick="scrollCarousel('univers', -1)">
                <i class="fas fa-chevron-left"></i>
            </button>
            <div class="carousel-track" id="universesGrid"></div>
            <button class="carousel-btn carousel-next" onclick="scrollCarousel('univers', 1)">
                <i class="fas fa-chevron-right"></i>
            </button>
        </div>
    </div>

    <!-- POPULAIRE -->
    <div class="section-crunchyroll" id="browse">
        <div class="section-header-cr">
            <h2 class="section-title-cr">
                <i class="fas fa-fire"></i>
                Les plus populaires
            </h2>
        </div>
        <div class="carousel-container">
            <button class="carousel-btn carousel-prev" onclick="scrollCarousel('popular', -1)">
                <i class="fas fa-chevron-left"></i>
            </button>
            <div class="carousel-track" id="popularCarousel"></div>
            <button class="carousel-btn carousel-next" onclick="scrollCarousel('popular', 1)">
                <i class="fas fa-chevron-right"></i>
            </button>
        </div>
    </div>

    <!-- LÉGENDES -->
    <div class="section-crunchyroll" id="legendes">
        <div class="section-header-cr">
            <h2 class="section-title-cr">
                <i class="fas fa-crown"></i>
                Légendes
            </h2>
        </div>
        <div class="carousel-container">
            <button class="carousel-btn carousel-prev" onclick="scrollCarousel('legendes', -1)">
                <i class="fas fa-chevron-left"></i>
            </button>
            <div class="carousel-track" id="legendesCarousel"></div>
            <button class="carousel-btn carousel-next" onclick="scrollCarousel('legendes', 1)">
                <i class="fas fa-chevron-right"></i>
            </button>
        </div>
    </div>

    <!-- RÉSEAUX SOCIAUX -->
    <div class="section-crunchyroll" id="reseaux">
        <div class="section-header-cr">
            <h2 class="section-title-cr">
                <i class="fas fa-globe"></i>
                Rejoignez la Communauté
            </h2>
        </div>
        <div class="social-grid-cr" id="socialGrid"></div>
    </div>

    <!-- MODAL LECTEUR VIDÉO -->
    <div class="player-modal-youtube" id="playerModal">
        <div class="youtube-layout">
            <button class="player-close" onclick="closePlayer()">
                <i class="fas fa-times"></i>
            </button>
            
            <div class="youtube-main">
                <div class="player-video-enhanced">
                    <div id="youtubePlayerContainer"></div>
                </div>
                
                <div class="video-info-section">
                    <h2 id="playerTitle"></h2>
                    <div class="video-meta">
                        <span id="playerEpisode"></span>
                    </div>
                    <div class="video-actions">
                        <button class="action-btn" id="addListBtnPlayer" onclick="toggleMyListFromPlayer()">
                            <i class="fas fa-plus"></i>
                            <span>Ma Liste</span>
                        </button>
                    </div>
                </div>
                
                <div class="video-description">
                    <div class="description-header">
                        <img id="characterAvatar" src="" alt="" class="character-avatar-small">
                        <div>
                            <h4 id="characterName"></h4>
                            <p id="characterShortDesc"></p>
                        </div>
                    </div>
                    <div class="description-content">
                        <p id="characterFullDesc"></p>
                    </div>
                </div>
            </div>
            
            <div class="youtube-sidebar">
                <h3 class="sidebar-title">Épisodes suggérés</h3>
                <div class="suggestions-list" id="suggestionsList"></div>
            </div>
        </div>
    </div>

    <!-- MODAL SÉRIE -->
    <div class="series-modal" id="seriesModal">
        <div class="series-modal-content">
            <button class="modal-close-btn" onclick="closeSeriesModal()">
                <i class="fas fa-times"></i>
            </button>
            <div class="series-hero" id="seriesHero">
                <!-- Vidéo pour Ned et Aaron -->
                <video id="heroVideo" class="hero-video" loop muted style="display:none;">
                    <source src="" type="video/mp4">
                    <track id="videoSubtitles" kind="subtitles" srclang="fr" label="Français" style="display:none;">
                </video>
                <div class="video-controls-hero" id="videoControlsHero" style="display:none;">
                    <button class="hero-control-btn" id="playPauseHero"><i class="fas fa-pause"></i></button>
                    <button class="hero-control-btn" id="muteHero"><i class="fas fa-volume-up"></i></button>
                    <input type="range" class="volume-slider" id="volumeSlider" min="0" max="100" value="50">
                    <button class="hero-control-btn" id="subtitlesHero" style="display:none;"><i class="fas fa-closed-captioning"></i></button>
                </div>
            </div>
            <div class="series-body">
                <div class="series-info-section">
                    <h2 id="seriesTitle"></h2>
                    <p id="seriesDescription"></p>
                    <div class="series-actions">
                        <button class="btn-series-action btn-primary" id="startBtn">
                            <i class="fas fa-play"></i> Commencer
                        </button>
                        <button class="btn-series-action btn-secondary" id="addToListBtn">
                            <i class="fas fa-plus"></i> Ajouter à Ma Liste
                        </button>
                    </div>
                </div>
                <div class="series-seasons">
                    <div class="season-tabs" id="seasonTabs"></div>
                    <div class="episodes-list-detailed" id="episodesListDetailed"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- BOUTON SCROLL TOP -->
    <div class="scroll-top-cr" id="scrollTop">
        <i class="fas fa-arrow-up"></i>
    </div>

    <!-- FOOTER -->
    <footer class="footer-cr">
        <div class="footer-container">
            <div class="footer-top">
                <div class="footer-logo">
                    <img src="images/logo.webp" alt="iPROMX" class="logo-image-footer">
                    <span class="logo-text-footer">iPROMX</span>
                </div>
                <div class="footer-links">
                    <a href="#univers">Parcourir</a>
                    <a href="#browse">Populaire</a>
                    <a href="#reseaux">Communauté</a>
                </div>
            </div>
            <div class="footer-bottom">
                <p>© 2025 L'Univers d'iProMx. Tous droits réservés.</p>
                <p>Propulsé par l'Œil du Faucon - Technologie de streaming avancée</p>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://www.youtube.com/iframe_api"></script>
    <script src="scriptv3.js"></script>
</body>
</html>